<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Aplicación para la revisión de contratos">
    <title>Revisión de Contratos</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" media="print" onload="this.media='all'" />
    <link rel="stylesheet" href="styles.css">
    <!-- Librerías desde CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" defer></script>
    <script src="script.js" defer></script>
</head>
<body>
    <header>
        <h1>Revisión de Contratos</h1>
        <div class="toolbar">
            <button data-action="saveJSON"><i class="fas fa-save"></i> Guardar JSON</button>
            <button data-action="loadJSON"><i class="fas fa-upload"></i> Cargar JSON</button>
            <input type="file" id="jsonFile" style="display: none;" accept=".json">
            <button data-action="downloadPDF"><i class="fas fa-file-pdf"></i> Descargar PDF</button>
            <button data-action="addContract"><i class="fas fa-plus"></i> Agregar al Histórico</button>
        </div>
    </header>
    <main>
        <nav class="tabs">
            <button class="tab-button active" data-tab="informacion" aria-selected="true">Información</button>
            <button class="tab-button" data-tab="financieros" aria-selected="false">Financieros</button>
            <button class="tab-button" data-tab="ejecucion" aria-selected="false">Ejecución</button>
            <button class="tab-button" data-tab="historico" aria-selected="false">Histórico</button>
            <button class="tab-button" data-tab="calendario" aria-selected="false">Calendario</button>
        </nav>
        <section id="informacion" class="tab-content active">
            <h2>Información General</h2>
            <div class="form-group">
                <label for="nombreProyecto">Nombre del Proyecto:</label>
                <input type="text" id="nombreProyecto" required>
                <span class="error-message"></span>
            </div>
            <div class="form-group">
                <label for="numeroContrato">No. Contrato:</label>
                <input type="text" id="numeroContrato">
            </div>
            <div class="form-group">
                <label for="nombreContratante">Contratante:</label>
                <input type="text" id="nombreContratante" required>
                <span class="error-message"></span>
            </div>
            <div class="form-group">
                <label for="cantidad">Cantidad:</label>
                <input type="number" id="cantidad" min="1" required>
                <span class="error-message"></span>
            </div>
            <div class="form-group">
                <label for="unidadMedida">Unidad de Medida:</label>
                <select id="unidadMedida">
                    <option value="M2">M²</option>
                    <option value="M3">M³</option>
                    <option value="Und">Und</option>
                </select>
            </div>
        </section>
        <section id="financieros" class="tab-content">
            <h2>Aspectos Financieros</h2>
            <div class="form-group">
                <label for="currency">Moneda:</label>
                <select id="currency">
                    <option value="COP">COP</option>
                    <option value="USD">USD</option>
                    <option value="EUR">EUR</option>
                </select>
            </div>
            <div class="form-group" id="trmUSD" style="display: none;">
                <label for="rateUSD">TRM USD:</label>
                <input type="number" id="rateUSD" value="4100" step="0.01">
            </div>
            <div class="form-group" id="trmEUR" style="display: none;">
                <label for="rateEUR">TRM EUR:</label>
                <input type="number" id="rateEUR" value="4500" step="0.01">
            </div>
            <div class="form-group">
                <label for="convertCurrency">Convertir a COP:</label>
                <input type="checkbox" id="convertCurrency" checked>
            </div>
            <div class="form-group">
                <label for="valorSubtotal">Costo Directo:</label>
                <input type="number" id="valorSubtotal" min="0" required>
                <span class="error-message"></span>
            </div>
            <div class="cop-section">
                <div class="form-group">
                    <label for="conAIU">Con AIU:</label>
                    <input type="checkbox" id="conAIU">
                </div>
                <div class="aiu-group">
                    <div class="form-group">
                        <label for="administracion">Administración (%):</label>
                        <input type="number" id="administracion" min="0" max="100" value="6">
                    </div>
                    <div class="form-group">
                        <label for="imprevistos">Imprevistos (%):</label>
                        <input type="number" id="imprevistos" min="0" max="100" value="6">
                    </div>
                    <div class="form-group">
                        <label for="utilidad">Utilidad (%):</label>
                        <input type="number" id="utilidad" min="0" max="100" value="6">
                    </div>
                </div>
                <div class="form-group">
                    <label for="iva">IVA (%):</label>
                    <input type="number" id="iva" min="0" max="100" value="19">
                </div>
            </div>
            <div class="results">
                <p>Costo Directo: <span id="valorSubtotalDisplay"></span></p>
                <p>Subtotal sin AIU: <span id="valorSubtotalSinAIU"></span></p>
                <div class="aiu-group">
                    <p>Administración: <span id="valorAdministracion"></span></p>
                    <p>Imprevistos: <span id="valorImprevistos"></span></p>
                    <p>Utilidad: <span id="valorUtilidad"></span></p>
                    <p>Total AIU: <span id="totalAIU"></span></p>
                </div>
                <p>Subtotal con AIU: <span id="valorSubtotalConAIU"></span></p>
                <p>IVA: <span id="valorIVA"></span></p>
                <p>Valor Total: <span id="valorTotal"></span></p>
                <p>Anticipo: <span id="valorAnticipo"></span></p>
                <p>Avance de Obra: <span id="porcentajeAvance"></span> - <span id="valorAvance"></span></p>
                <p>Retenido: <span id="valorRetenido"></span></p>
            </div>
            <div class="form-group">
                <label for="porcentajeAnticipo">Anticipo (%):</label>
                <input type="number" id="porcentajeAnticipo" min="0" max="100" value="30">
            </div>
            <div class="form-group">
                <label for="porcentajeRetenido">Retenido (%):</label>
                <input type="number" id="porcentajeRetenido" min="0" max="100" value="10">
            </div>
        </section>
        <section id="ejecucion" class="tab-content">
            <h2>Condiciones de Ejecución</h2>
            <div class="form-group">
                <label for="fechaInicio">Fecha de Inicio:</label>
                <input type="date" id="fechaInicio" required>
                <span class="error-message"></span>
            </div>
            <div class="form-group">
                <label for="plazoEjecucion">Plazo de Ejecución (días):</label>
                <input type="number" id="plazoEjecucion" min="1" required>
                <span class="error-message"></span>
            </div>
            <div class="form-group">
                <label for="periodicidadCortes">Periodicidad de Cortes:</label>
                <select id="periodicidadCortes">
                    <option value="semanal">Semanal</option>
                    <option value="quincenal">Quincenal</option>
                </select>
            </div>
            <p>Fecha Final: <span id="fechaFinal"></span></p>
            <div id="cronograma" style="display: block;">Cronograma no calculado</div>
            <table id="cronogramaTable" style="display: none;">
                <thead>
                    <tr>
                        <th>Etapa</th>
                        <th>Fecha</th>
                        <th>Cantidad</th>
                        <th>Valor</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </section>
        <section id="historico" class="tab-content">
            <h2>Histórico de Contratos</h2>
            <table id="tablaHistorico">
                <thead>
                    <tr>
                        <th>Proyecto</th>
                        <th>Contratante</th>
                        <th>Cantidad</th>
                        <th>Valor Total</th>
                        <th>Plazo</th>
                        <th>Inicio</th>
                        <th>Fin</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <footer>
                <button data-action="downloadHistoryPDF"><i class="fas fa-file-pdf"></i> Descargar PDF</button>
                <button data-action="downloadHistoryExcel"><i class="fas fa-file-excel"></i> Descargar Excel</button>
                <button data-action="clearHistory"><i class="fas fa-trash"></i> Borrar Histórico</button>
            </footer>
        </section>
        <section id="calendario" class="tab-content">
            <h2>Calendario Anual</h2>
            <div class="calendar-controls">
                <button id="prevYear"><i class="fas fa-chevron-left"></i></button>
                <span id="calendarYear"></span>
                <button id="nextYear"><i class="fas fa-chevron-right"></i></button>
                <button id="toggleBars"><i class="fas fa-chart-bar"></i></button>
            </div>
            <table id="calendarioTable">
                <thead>
                    <tr>
                        <th>Proyecto</th>
                        <th>Ene</th>
                        <th>Feb</th>
                        <th>Mar</th>
                        <th>Abr</th>
                        <th>May</th>
                        <th>Jun</th>
                        <th>Jul</th>
                        <th>Ago</th>
                        <th>Sep</th>
                        <th>Oct</th>
                        <th>Nov</th>
                        <th>Dic</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody></tbody>
                <tfoot></tfoot>
            </table>
            <footer>
                <button data-action="downloadCalendarPDF"><i class="fas fa-file-pdf"></i> Descargar PDF</button>
                <button data-action="downloadCalendarExcel"><i class="fas fa-file-excel"></i> Descargar Excel</button>
            </footer>
        </section>
    </main>
</body>
</html>
